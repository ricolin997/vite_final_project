import{u as H,r as M,f as c,g as d,k as W,t as r,n as y,h as s,o as z,D as ts,l as _,F as P,s as D,M as O,b as es,c as k,w as V,e as as,i as b,j as $,v as E,y as N,I as os,m as w,N as is}from"./index-IaK2R5-W.js";import{_ as ns}from"./Pagination-wja8j1Sf.js";const ls="/vite_final_project/assets/member_profile-DtdUWIN6.jpg",cs="/vite_final_project/assets/order_thumbnail-Csuz3zNX.jpg",ds="/vite_final_project/assets/point_breakfast-BLvyB4hp.jpg",rs="/vite_final_project/assets/point_spa-D0MWbQA9.jpg",vs="/vite_final_project/assets/point_room-BNL1G8v3.jpg",us=(a,v)=>new Promise(l=>{const e=document.createElement("div");e.className="dialog-overlay";const u=document.createElement("div");u.className="dialog-box",u.innerHTML=`
      <div class="dialog-header">
        <h3>${a}</h3>
      </div>
      <div class="dialog-content">
        <p>${v}</p>
      </div>
      <div class="dialog-actions">
        <button class="btn-cancel">取消</button>
        <button class="btn-confirm">確認</button>
      </div>
    `,e.appendChild(u),document.body.appendChild(e),setTimeout(()=>{e.classList.add("show"),u.classList.add("show")},10);const h=u.querySelector(".btn-cancel"),g=u.querySelector(".btn-confirm"),n=m=>{e.classList.remove("show"),u.classList.remove("show"),setTimeout(()=>{document.body.removeChild(e),l(m)},300)};h.addEventListener("click",()=>n(!1)),g.addEventListener("click",()=>n(!0))}),F=(a,v="success")=>{const l=document.getElementById("toast-container")||ps(),e=document.createElement("div");e.className=`toast-notification ${v}`,e.innerHTML=`
    <div class="toast-icon">
      <i class="fas fa-${v==="success"?"check-circle":v==="danger"?"exclamation-circle":v==="warning"?"exclamation-triangle":"info-circle"}"></i>
    </div>
    <div class="toast-message">${a}</div>
  `,l.appendChild(e),setTimeout(()=>{e.classList.add("show")},10),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>{e.remove()},300)},3e3)},ps=()=>{const a=document.createElement("div");return a.id="toast-container",document.body.appendChild(a),a},hs=a=>{try{const v=document.getElementById(a);if(v){if(window.bootstrap){const u=window.bootstrap.Modal.getInstance(v);if(u){u.hide();return}}if(window.jQuery){window.jQuery(`#${a}`).modal("hide");return}const l=v.querySelector('[data-bs-dismiss="modal"]');if(l){l.click();return}v.classList.remove("show"),v.setAttribute("aria-hidden","true"),v.removeAttribute("aria-modal"),v.style.display="none";const e=document.querySelector(".modal-backdrop");e&&e.remove(),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""}}catch(v){console.error("關閉模態框失敗：",v)}},_s=["disabled"],ms={key:0},fs=s("i",{class:"fas fa-spinner fa-spin"},null,-1),bs={key:1},G=Object.assign({name:"PaymentButton"},{__name:"PaymentButton",props:{orderId:{type:String,required:!0},buttonText:{type:String,default:"付款"},buttonClass:{type:String,default:""},closeModalId:{type:String,default:""},highlightSelector:{type:String,default:""}},emits:["payment-success","payment-error"],setup(a,{emit:v}){const l=a,e=v,u=H(),h=M(!1),g=()=>{l.highlightSelector&&setTimeout(()=>{const p=document.querySelector(l.highlightSelector);p&&(p.classList.add("highlight-success"),setTimeout(()=>{p.classList.remove("highlight-success")},3e3))},300)},n=()=>{l.closeModalId&&setTimeout(()=>{hs(l.closeModalId)},500)},m=async()=>{if(await us("付款確認","確定要進行付款嗎？")){h.value=!0;try{await u.payOrder(l.orderId),F("付款成功！","success"),e("payment-success",l.orderId),g(),n()}catch(p){console.error("付款失敗：",p),F("付款失敗："+(p.message||"請稍後再試"),"danger"),e("payment-error",p)}finally{h.value=!1}}};return(p,S)=>(c(),d("button",{class:y(["pay-btn",a.buttonClass]),onClick:m,disabled:h.value},[h.value?(c(),d("span",ms,[fs,W(" 處理中... ")])):(c(),d("span",bs,r(a.buttonText),1))],10,_s))}}),ys={class:"modal fade order-modal",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},gs={class:"modal-dialog modal-lg"},$s={class:"modal-content"},ws=s("div",{class:"modal-header"},[s("h5",{class:"modal-title",id:"orderModalLabel"},"訂單詳細資訊"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ks={key:0,class:"modal-body loading"},Ms=s("p",null,"正在載入資料...",-1),Cs=[Ms],Ss={key:1,class:"modal-body"},Ts={class:"order-section"},Ls={class:"order-info"},Ps={class:"info-item"},Ds=s("span",{class:"label"},"訂單編號：",-1),xs={class:"value"},Bs={class:"info-item"},Es=s("span",{class:"label"},"訂單日期：",-1),Ns={class:"value"},Os={class:"order-section"},Is=s("h3",{class:"section-title"},"顧客資訊",-1),Us={class:"customer-info"},js={class:"info-list"},As=s("span",{class:"label"},"姓名：",-1),qs={class:"value"},Vs=s("span",{class:"label"},"電話：",-1),Fs={class:"value"},Hs=s("span",{class:"label"},"地址：",-1),Ws={class:"value"},zs={key:0,class:"message"},Gs=s("span",{class:"label"},"留言：",-1),Qs={class:"value"},Rs={class:"order-section"},Xs=s("h3",{class:"section-title"},"預訂商品",-1),Ys={class:"products-list"},Js={class:"product-table"},Ks=s("thead",null,[s("tr",null,[s("th",null,"商品名稱"),s("th",null,"數量"),s("th",null,"價格")])],-1),Zs={class:"product-name"},st={class:"product-qty"},tt={class:"product-price"},et={class:"order-section"},at={class:"payment-info"},ot={class:"payment-status"},it=s("span",{class:"status-label"},"付款狀態:",-1),nt={key:0,class:"payment-method"},lt={class:"total-amount"},ct=s("span",{class:"label"},"總金額：",-1),dt={class:"value"},rt={class:"modal-footer"},vt=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1),ut=Object.assign({name:"UserOrderDetailModal"},{__name:"UserOrderDetailModal",props:{order:{type:Object,default:()=>null},isLoading:{type:Boolean,default:!1}},emits:["order-paid"],setup(a,{emit:v}){const l=v,e=n=>new Date(n*1e3).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}),u=()=>{const n=document.querySelector(".modal-backdrop");n&&n.remove(),document.body.classList.remove("modal-open"),document.body.style.overflow="",document.body.style.paddingRight=""},h=()=>{const n=document.getElementById("orderModal");if(n){try{if(window.bootstrap){const m=window.bootstrap.Modal.getInstance(n);if(m){m.hide();return}}}catch(m){console.error("使用 Bootstrap API 關閉模態框失敗:",m)}n.classList.remove("show"),n.style.display="none",n.setAttribute("aria-hidden","true"),n.removeAttribute("aria-modal"),u()}},g=n=>{l("order-paid",n),setTimeout(()=>{h()},600)};return z(()=>{const n=document.getElementById("orderModal");n&&n.addEventListener("hidden.bs.modal",u)}),ts(()=>{const n=document.getElementById("orderModal");n&&n.removeEventListener("hidden.bs.modal",u)}),(n,m)=>(c(),d("div",ys,[s("div",gs,[s("div",$s,[ws,a.isLoading?(c(),d("div",ks,Cs)):a.order?(c(),d("div",Ss,[s("div",Ts,[s("div",Ls,[s("div",Ps,[Ds,s("span",xs,r(a.order.id),1)]),s("div",Bs,[Es,s("span",Ns,r(e(a.order.create_at)),1)])])]),s("div",Os,[Is,s("div",Us,[s("ul",js,[s("li",null,[As,s("span",qs,r(a.order.user.name),1)]),s("li",null,[Vs,s("span",Fs,r(a.order.user.tel),1)]),s("li",null,[Hs,s("span",Ws,r(a.order.user.address),1)])]),a.order.message?(c(),d("div",zs,[Gs,s("div",Qs,r(a.order.message),1)])):_("",!0)])]),s("div",Rs,[Xs,s("div",Ys,[s("table",Js,[Ks,s("tbody",null,[(c(!0),d(P,null,D(a.order.products,p=>(c(),d("tr",{key:p.id},[s("td",Zs,r(p.product.title),1),s("td",st,r(p.qty),1),s("td",tt,"NT$ "+r(n.$formatPrice(p.final_total)),1)]))),128))])])])]),s("div",et,[s("div",at,[s("div",ot,[it,s("span",{class:y(["status-value",a.order.is_paid?"paid":"unpaid"])},r(a.order.is_paid?"已付款":"未付款"),3),a.order.is_paid?(c(),d("span",nt," ("+r(a.order.payment_method)+") ",1)):_("",!0)]),s("div",lt,[ct,s("span",dt,"NT$ "+r(n.$formatPrice(a.order.total)),1)])])])])):_("",!0),s("div",rt,[a.order&&!a.order.is_paid?(c(),O(G,{key:0,"order-id":a.order.id,"button-class":"btn btn-primary","close-modal-id":"orderModal","highlight-selector":a.order?`[data-order-id='${a.order.id}']`:"",onPaymentSuccess:g},null,8,["order-id","highlight-selector"])):_("",!0),vt])])])]))}}),pt={class:"user-member"},ht={class:"container"},_t=s("div",{class:"member-header"},[s("h1",{class:"member-title"},"會員專區"),s("p",{class:"member-subtitle"},"尊貴的 SHIBA 會員，歡迎回來")],-1),mt={class:"member-content"},ft={class:"member-sidebar"},bt=w('<div class="member-profile"><div class="profile-avatar"><img src="'+ls+'" alt="會員頭像" class="avatar-img"></div><div class="profile-info"><h3 class="profile-name">尊貴會員</h3><p class="profile-level">金卡會員</p></div></div>',1),yt={class:"member-nav"},gt=s("i",{class:"fas fa-user"},null,-1),$t=s("span",null,"個人檔案",-1),wt=s("i",{class:"fas fa-list-alt"},null,-1),kt=s("span",null,"我的訂單",-1),Mt=s("i",{class:"fas fa-heart"},null,-1),Ct=s("span",null,"我的最愛",-1),St=s("i",{class:"fas fa-ticket-alt"},null,-1),Tt=s("span",null,"會員優惠",-1),Lt=s("i",{class:"fas fa-coins"},null,-1),Pt=s("span",null,"積分兌換",-1),Dt=s("i",{class:"fas fa-history"},null,-1),xt=s("span",null,"消費紀錄",-1),Bt=s("i",{class:"fas fa-shield-alt"},null,-1),Et=s("span",null,"隱私設定",-1),Nt=w('<div class="member-stats"><div class="stat-item"><div class="stat-icon"><i class="fas fa-calendar-check"></i></div><div class="stat-info"><span class="stat-value">5</span><span class="stat-label">入住次數</span></div></div><div class="stat-item"><div class="stat-icon"><i class="fas fa-star"></i></div><div class="stat-info"><span class="stat-value">2,500</span><span class="stat-label">累積點數</span></div></div></div>',1),Ot={class:"member-main"},It={key:0,class:"tab-content profile-tab"},Ut=w('<div class="content-header"><h2>個人檔案</h2><button class="edit-btn"><i class="fas fa-edit"></i><span>編輯資料</span></button></div><div class="profile-section"><h3 class="section-title">基本資料</h3><div class="profile-grid"><div class="profile-item"><span class="item-label">姓名</span><span class="item-value">王小明</span></div><div class="profile-item"><span class="item-label">電子郵件</span><span class="item-value">example@email.com</span></div><div class="profile-item"><span class="item-label">手機號碼</span><span class="item-value">0912-345-678</span></div><div class="profile-item"><span class="item-label">生日</span><span class="item-value">1990/01/01</span></div><div class="profile-item"><span class="item-label">地址</span><span class="item-value">台北市信義區松高路123號</span></div><div class="profile-item"><span class="item-label">會員等級</span><span class="item-value gold">金卡會員</span></div></div></div><div class="profile-section"><h3 class="section-title">偏好設定</h3><div class="preferences"><div class="preference-item"><span class="pref-label">語言偏好</span><span class="pref-value">繁體中文</span></div><div class="preference-item"><span class="pref-label">通知設定</span><div class="toggle-switches"><div class="toggle-item"><span>電子郵件通知</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div><div class="toggle-item"><span>簡訊通知</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div><div class="toggle-item"><span>優惠資訊</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div></div></div></div></div>',3),jt=[Ut],At={key:1,class:"tab-content orders-tab"},qt={class:"content-header"},Vt=s("h2",null,"訂單列表",-1),Ft={class:"filter-options"},Ht=s("option",{value:"all"},"所有訂單",-1),Wt=s("option",{value:"paid"},"已付款",-1),zt=s("option",{value:"unpaid"},"未付款",-1),Gt=[Ht,Wt,zt],Qt={key:0,class:"orders-list mb-4"},Rt=["data-order-id"],Xt={class:"order-header"},Yt={class:"order-id"},Jt=s("span",{class:"label"},"訂單編號：",-1),Kt={class:"value"},Zt={class:"order-body"},se=s("div",{class:"order-image"},[s("img",{src:cs,alt:"訂單圖片"})],-1),te={class:"order-details"},ee={class:"room-type"},ae={class:"order-date"},oe=s("i",{class:"fas fa-calendar-alt"},null,-1),ie={class:"customer-info"},ne=s("i",{class:"fas fa-user"},null,-1),le={class:"price"},ce=s("span",{class:"label"},"總價：",-1),de={class:"value"},re={class:"order-footer"},ve=["onClick"],ue={key:1,class:"no-orders"},pe=s("i",{class:"fas fa-shopping-bag"},null,-1),he=s("p",null,"您目前沒有訂單",-1),_e=s("i",{class:"fas fa-search"},null,-1),me=s("span",null,"瀏覽客房",-1),fe={key:2,class:"tab-content favorites-tab"},be={class:"content-header"},ye=s("h2",null,"我的最愛",-1),ge={class:"sort-options"},$e=s("option",{value:"newest"},"最新加入",-1),we=s("option",{value:"price-high"},"價格由高至低",-1),ke=s("option",{value:"price-low"},"價格由低至高",-1),Me=[$e,we,ke],Ce={class:"favorites-grid"},Se={class:"favorite-image"},Te=["src","alt"],Le=["onClick"],Pe=s("i",{class:"fas fa-heart"},null,-1),De=[Pe],xe={class:"favorite-content"},Be={class:"room-type"},Ee=w('<div class="room-features"><span class="feature"><i class="fas fa-user-friends"></i> 2-4 人</span><span class="feature"><i class="fas fa-vector-square"></i> 40-120 m²</span><span class="feature"><i class="fas fa-bed"></i> 豪華床型</span></div>',1),Ne={class:"room-price"},Oe={class:"price"},Ie=s("span",{class:"per-night"},"/ 晚",-1),Ue={class:"card-actions"},je=["onClick"],Ae=["onClick"],qe={key:0,class:"no-favorites"},Ve=s("i",{class:"fas fa-heart-broken"},null,-1),Fe=s("p",null,"您目前沒有收藏的客房",-1),He=s("i",{class:"fas fa-search"},null,-1),We=s("span",null,"瀏覽客房",-1),ze={key:3,class:"tab-content coupons-tab"},Ge={class:"content-header"},Qe=s("h2",null,"會員優惠",-1),Re={class:"filter-options"},Xe=s("option",{value:"all"},"所有優惠",-1),Ye=s("option",{value:"available"},"可使用",-1),Je=s("option",{value:"used"},"已使用",-1),Ke=s("option",{value:"expired"},"已過期",-1),Ze=[Xe,Ye,Je,Ke],sa={class:"coupons-list"},ta={class:"coupon-left"},ea={class:"discount-amount"},aa=s("span",null,"折",-1),oa={class:"coupon-right"},ia={class:"coupon-info"},na={class:"coupon-title"},la={class:"coupon-desc"},ca={class:"coupon-validity"},da=s("i",{class:"fas fa-calendar-alt"},null,-1),ra={class:"coupon-actions"},va=["onClick"],ua={class:"coupon-code"},pa=s("span",null,"優惠碼：",-1),ha=s("div",{class:"coupon-status"},"可使用",-1),_a=w('<div class="coupon-card used"><div class="coupon-left"><div class="discount-amount">9<span>折</span></div></div><div class="coupon-right"><div class="coupon-info"><h3 class="coupon-title">新會員優惠</h3><p class="coupon-desc">新會員首次預訂享 9 折優惠</p><div class="coupon-validity"><i class="fas fa-calendar-alt"></i><span>有效期限：2023/10/31</span></div></div><div class="coupon-actions"><button class="use-coupon-btn" disabled>已使用</button><div class="coupon-code"><span>優惠碼：</span><strong>WELCOME10</strong></div></div></div><div class="coupon-status">已使用</div></div>',1),ma={key:4,class:"tab-content points-tab"},fa=w('<div class="content-header"><h2>積分兌換</h2><div class="points-balance"><i class="fas fa-coins"></i><span>目前積分：<strong>2,500</strong> 點</span></div></div><div class="points-info-card"><div class="points-info-header"><i class="fas fa-info-circle"></i><h3>積分說明</h3></div><div class="points-info-content"><p>每消費 NT$ 100 可獲得 1 點積分</p><p>積分可用於兌換免費住宿、餐飲優惠或升級房型</p><p>積分有效期為獲取日起計算 2 年</p></div></div><h3 class="section-title">可兌換項目</h3><div class="rewards-grid"><div class="reward-card"><div class="reward-image"><img src="'+ds+'" alt="免費早餐"></div><div class="reward-content"><h4>雙人豪華早餐</h4><p>兌換一次雙人豪華自助早餐</p><div class="reward-points"><i class="fas fa-coins"></i><span>500 點</span></div><button class="redeem-btn">立即兌換</button></div></div><div class="reward-card"><div class="reward-image"><img src="'+rs+'" alt="SPA 折扣"></div><div class="reward-content"><h4>SPA 療程 8 折券</h4><p>兌換一次 SPA 療程 8 折優惠</p><div class="reward-points"><i class="fas fa-coins"></i><span>800 點</span></div><button class="redeem-btn">立即兌換</button></div></div><div class="reward-card"><div class="reward-image"><img src="'+vs+'" alt="免費住宿"></div><div class="reward-content"><h4>免費住宿一晚</h4><p>兌換豪華雙人房免費住宿一晚</p><div class="reward-points"><i class="fas fa-coins"></i><span>2,000 點</span></div><button class="redeem-btn">立即兌換</button></div></div></div>',4),ba=[fa],ya={key:5,class:"tab-content history-tab"},ga=w('<div class="content-header"><h2>消費紀錄</h2><div class="filter-options"><select class="filter-select"><option value="all">所有紀錄</option><option value="accommodation">住宿消費</option><option value="dining">餐飲消費</option><option value="spa">SPA 消費</option></select></div></div><div class="history-list"><div class="history-card"><div class="history-date"><div class="date-day">15</div><div class="date-month">10月</div><div class="date-year">2023</div></div><div class="history-details"><div class="history-title"><h3>豪華套房住宿</h3><span class="history-category accommodation">住宿消費</span></div><div class="history-info"><p>入住日期：2023/10/15 - 2023/10/17</p><p>房號：1205</p></div></div><div class="history-amount"><div class="amount">NT$ 15,600</div><div class="points-earned"><i class="fas fa-coins"></i><span>+156 點</span></div></div></div><div class="history-card"><div class="history-date"><div class="date-day">16</div><div class="date-month">10月</div><div class="date-year">2023</div></div><div class="history-details"><div class="history-title"><h3>頂級 SPA 療程</h3><span class="history-category spa">SPA 消費</span></div><div class="history-info"><p>療程時間：90 分鐘</p><p>療程師：Sarah</p></div></div><div class="history-amount"><div class="amount">NT$ 3,800</div><div class="points-earned"><i class="fas fa-coins"></i><span>+38 點</span></div></div></div><div class="history-card"><div class="history-date"><div class="date-day">16</div><div class="date-month">10月</div><div class="date-year">2023</div></div><div class="history-details"><div class="history-title"><h3>頂級餐廳晚餐</h3><span class="history-category dining">餐飲消費</span></div><div class="history-info"><p>用餐人數：2 人</p><p>餐廳：La Vue</p></div></div><div class="history-amount"><div class="amount">NT$ 4,200</div><div class="points-earned"><i class="fas fa-coins"></i><span>+42 點</span></div></div></div></div>',2),$a=[ga],wa={key:6,class:"tab-content privacy-tab"},ka=w('<div class="content-header"><h2>隱私設定</h2><button class="save-btn"><i class="fas fa-save"></i><span>儲存設定</span></button></div><div class="privacy-section"><h3 class="section-title">帳戶安全</h3><div class="privacy-options"><div class="privacy-option"><div class="option-info"><h4>變更密碼</h4><p>定期更改密碼可以提高帳戶安全性</p></div><button class="change-btn">變更</button></div><div class="privacy-option"><div class="option-info"><h4>雙重驗證</h4><p>啟用雙重驗證以增強帳戶安全</p></div><label class="switch"><input type="checkbox"><span class="slider"></span></label></div><div class="privacy-option"><div class="option-info"><h4>登入通知</h4><p>當有新裝置登入時接收通知</p></div><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div></div></div><div class="privacy-section"><h3 class="section-title">資料隱私</h3><div class="privacy-options"><div class="privacy-option"><div class="option-info"><h4>個人資料可見性</h4><p>控制您的個人資料對其他用戶的可見性</p></div><select class="privacy-select"><option value="private">僅限本人</option><option value="staff">僅限酒店員工</option><option value="public">公開</option></select></div><div class="privacy-option"><div class="option-info"><h4>行銷電子郵件</h4><p>接收有關促銷和特別優惠的電子郵件</p></div><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div><div class="privacy-option"><div class="option-info"><h4>Cookie 設定</h4><p>管理網站使用的 Cookie 設定</p></div><button class="manage-btn">管理</button></div></div></div><div class="privacy-section"><h3 class="section-title">資料下載與刪除</h3><div class="privacy-options"><div class="privacy-option"><div class="option-info"><h4>下載個人資料</h4><p>下載您在 SHIBA 酒店的所有個人資料</p></div><button class="download-btn">下載</button></div><div class="privacy-option danger"><div class="option-info"><h4>刪除帳戶</h4><p>永久刪除您的帳戶和所有相關資料</p></div><button class="delete-btn">刪除</button></div></div></div>',4),Ma=[ka],Ta={__name:"UserMember",props:{tab:{type:String,default:"profile"}},setup(a){const v=a,l=H(),e=M(v.tab||"profile"),u=es(),h=M(!1),g=M(!1),n=k(()=>l.orders||[]),m=k(()=>l.pagination||{}),p=k(()=>l.currentOrder),S=M("all"),C=M("all"),Q=k(()=>C.value==="all"?l.coupons||[]:(l.coupons||[]).filter(t=>C.value==="available"?!t.is_used&&new Date(t.due_date)>new Date:C.value==="used"?t.is_used:C.value==="expired"?new Date(t.due_date)<=new Date:!0)),I=k(()=>S.value==="all"?n.value:n.value.filter(t=>S.value==="paid"?t.is_paid:!t.is_paid)),T=M("newest"),x=k(()=>l.favorites||[]),U=k(()=>T.value==="price-high"?[...x.value].sort((t,i)=>i.price-t.price):T.value==="price-low"?[...x.value].sort((t,i)=>t.price-i.price):[...x.value].reverse()),R=t=>{l.removeFromFavorites(t)},X=async t=>{try{await l.addToCart(t,1),alert("成功加入購物車")}catch{alert("加入購物車失敗")}},Y=async t=>{h.value=!0;try{await l.getCart(),l.cart&&l.cart.length>0?(u.push("/user/cart"),localStorage.setItem("autoApplyPromoCode",t)):(u.push("/user/products"),alert("您的購物車是空的，請先選擇商品"))}catch(i){console.error("處理優惠碼失敗：",i)}finally{h.value=!1}},J=t=>{u.push({name:"UserProductDetail",params:{id:t}})},B=async(t=1)=>{h.value=!0;try{await l.getUserOrders(t)}catch(i){console.error("取得訂單失敗：",i)}finally{h.value=!1}},K=async t=>{try{g.value=!0,await l.getUserOrderDetails(t)}catch(i){console.error("載入訂單詳情失敗：",i)}finally{g.value=!1}},j=t=>{const i=n.value.findIndex(f=>f.id===t);i!==-1&&(n.value[i].is_paid=!0),p.value&&p.value.id===t&&(p.value.is_paid=!0)},Z=async()=>{try{await l.getCoupons()}catch(t){console.error("取得優惠券失敗：",t)}},A=t=>{if(!t)return"無日期資訊";let i;return typeof t=="number"?i=new Date(t*1e3):typeof t=="string"?i=new Date(t):i=t,isNaN(i.getTime())?"無效日期":i.toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"})},ss=t=>t.products&&Object.keys(t.products).length>0?Object.values(t.products)[0].product.title||"未知商品":"訂單詳情",q=t=>{const i=t||"profile";i==="orders"&&n.value.length===0&&B(),u.push({name:"UserMember",params:{tab:i}})};return V(()=>v.tab,t=>{const i=t||"profile";i!==e.value&&(e.value=i,q(i))}),V(e,t=>{q(t)}),z(()=>{(!v.tab||v.tab==="")&&u.push({name:"UserMember",params:{tab:"profile"}}),e.value==="orders"&&B(),Z()}),(t,i)=>{const f=as("router-link");return c(),d("div",pt,[s("div",ht,[_t,s("div",mt,[s("div",ft,[bt,s("div",yt,[b(f,{to:{name:"UserMember",params:{tab:"profile"}},class:y(["nav-item",{active:e.value==="profile"}])},{default:$(()=>[gt,$t]),_:1},8,["class"]),b(f,{to:{name:"UserMember",params:{tab:"orders"}},class:y(["nav-item",{active:e.value==="orders"}])},{default:$(()=>[wt,kt]),_:1},8,["class"]),b(f,{to:{name:"UserMember",params:{tab:"favorites"}},class:y(["nav-item",{active:e.value==="favorites"}])},{default:$(()=>[Mt,Ct]),_:1},8,["class"]),b(f,{to:{name:"UserMember",params:{tab:"coupons"}},class:y(["nav-item",{active:e.value==="coupons"}])},{default:$(()=>[St,Tt]),_:1},8,["class"]),b(f,{to:{name:"UserMember",params:{tab:"points"}},class:y(["nav-item",{active:e.value==="points"}])},{default:$(()=>[Lt,Pt]),_:1},8,["class"]),b(f,{to:{name:"UserMember",params:{tab:"history"}},class:y(["nav-item",{active:e.value==="history"}])},{default:$(()=>[Dt,xt]),_:1},8,["class"]),b(f,{to:{name:"UserMember",params:{tab:"privacy"}},class:y(["nav-item",{active:e.value==="privacy"}])},{default:$(()=>[Bt,Et]),_:1},8,["class"])]),Nt]),s("div",Ot,[e.value==="profile"?(c(),d("div",It,jt)):_("",!0),e.value==="orders"?(c(),d("div",At,[s("div",qt,[Vt,s("div",Ft,[E(s("select",{class:"filter-select","onUpdate:modelValue":i[0]||(i[0]=o=>S.value=o)},Gt,512),[[N,S.value]])])]),b(os(is),{active:h.value},null,8,["active"]),h.value?_("",!0):(c(),d("div",Qt,[(c(!0),d(P,null,D(I.value,o=>(c(),d("div",{key:o.id,class:"order-card","data-order-id":o.id},[s("div",Xt,[s("div",Yt,[Jt,s("span",Kt,r(o.id),1)]),s("div",{class:y(["order-status",{completed:o.is_paid,upcoming:!o.is_paid}])},r(o.is_paid?"已付款":"待付款"),3)]),s("div",Zt,[se,s("div",te,[s("h3",ee,r(ss(o)),1),s("div",ae,[oe,s("span",null,"訂單日期："+r(A(o.create_at)),1)]),s("div",ie,[ne,s("span",null,"客戶："+r(o.user.name),1)]),s("div",le,[ce,s("span",de,"NT$ "+r(t.$formatPrice(o.total)),1)])])]),s("div",re,[s("button",{class:"detail-btn",onClick:L=>K(o.id),"data-bs-toggle":"modal","data-bs-target":"#orderModal"}," 查看詳情 ",8,ve),o.is_paid?_("",!0):(c(),O(G,{key:0,"order-id":o.id,"highlight-selector":`[data-order-id='${o.id}']`,onPaymentSuccess:j},null,8,["order-id","highlight-selector"]))])],8,Rt))),128))])),!h.value&&I.value.length===0?(c(),d("div",ue,[pe,he,b(f,{to:"/user/products",class:"browse-btn"},{default:$(()=>[_e,me]),_:1})])):_("",!0),m.value.total_pages>1?(c(),O(ns,{key:2,pages:m.value,onEmitPages:B},null,8,["pages"])):_("",!0),b(ut,{order:p.value,"is-loading":g.value,onOrderPaid:j},null,8,["order","is-loading"])])):_("",!0),e.value==="favorites"?(c(),d("div",fe,[s("div",be,[ye,s("div",ge,[E(s("select",{class:"sort-select","onUpdate:modelValue":i[1]||(i[1]=o=>T.value=o)},Me,512),[[N,T.value]])])]),s("div",Ce,[(c(!0),d(P,null,D(U.value,o=>(c(),d("div",{key:o.id,class:"favorite-card"},[s("div",Se,[s("img",{src:o.imageUrl||"https://images.unsplash.com/photo-1566665797739-1674de7a421a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80",alt:o.title},null,8,Te),s("button",{class:"remove-favorite",onClick:L=>R(o.id)},De,8,Le)]),s("div",xe,[s("h3",Be,r(o.title),1),Ee,s("div",Ne,[s("span",Oe,"NT$ "+r(t.$formatPrice(o.price)),1),Ie]),s("div",Ue,[s("button",{class:"view-btn",onClick:L=>J(o.id)}," 查看詳情 ",8,je),s("button",{class:"book-btn",onClick:L=>X(o.id)},"立即預訂",8,Ae)])])]))),128))]),U.value.length===0?(c(),d("div",qe,[Ve,Fe,b(f,{to:"/user/products",class:"browse-btn"},{default:$(()=>[He,We]),_:1})])):_("",!0)])):_("",!0),e.value==="coupons"?(c(),d("div",ze,[s("div",Ge,[Qe,s("div",Re,[E(s("select",{class:"filter-select","onUpdate:modelValue":i[2]||(i[2]=o=>C.value=o)},Ze,512),[[N,C.value]])])]),s("div",sa,[(c(!0),d(P,null,D(Q.value,o=>(c(),d("div",{key:o.id,class:"coupon-card available"},[s("div",ta,[s("div",ea,[W(r(o.percent),1),aa])]),s("div",oa,[s("div",ia,[s("h3",na,r(o.title),1),s("p",la,r(o.description||"使用此優惠券可享折扣"),1),s("div",ca,[da,s("span",null,"有效期限："+r(A(o.due_date)),1)])]),s("div",ra,[s("button",{class:"use-coupon-btn",onClick:L=>Y(o.code)}," 立即使用 ",8,va),s("div",ua,[pa,s("strong",null,r(o.code),1)])])]),ha]))),128)),_a])])):_("",!0),e.value==="points"?(c(),d("div",ma,ba)):_("",!0),e.value==="history"?(c(),d("div",ya,$a)):_("",!0),e.value==="privacy"?(c(),d("div",wa,Ma)):_("",!0)])])])])}}};export{Ta as default};
