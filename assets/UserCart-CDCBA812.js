import{u as W,r as p,c as q,o as X,e as N,f as l,g as n,i as $,h as s,t as c,F as I,s as B,l as g,v as L,x as j,n as V,k as E,I as Y,j as P,m as Z}from"./index-IaK2R5-W.js";const R={class:"user-cart"},D={class:"container"},ss=s("div",{class:"cart-header"},[s("h2",null,"您的精選購物車"),s("p",{class:"subtitle"},"為您的奢華住宿體驗提供尊貴服務")],-1),es={key:0,class:"cart-content"},ts={class:"cart-items-container"},os={class:"cart-items-header"},as=s("h3",null,"已選擇的客房",-1),ls={class:"cart-items-count"},ns={class:"cart-items"},cs={class:"item-image"},is=["src","alt"],us=s("div",{class:"image-overlay"},null,-1),rs={class:"item-details"},ds={class:"item-title"},_s={key:0,class:"item-description"},vs={key:1,class:"item-features"},ps={class:"item-quantity"},hs=["onClick","disabled"],fs=s("i",{class:"fas fa-minus"},null,-1),ms=[fs],ys=["onUpdate:modelValue","onChange"],gs=["onClick"],Cs=s("i",{class:"fas fa-plus"},null,-1),ks=[Cs],bs={class:"item-price"},ws={class:"price"},xs=s("span",{class:"price-unit"},"/晚",-1),Ts={class:"subtotal"},qs={class:"item-remove"},$s=["onClick"],Vs=s("i",{class:"fas fa-trash"},null,-1),As=[Vs],Is={class:"cart-summary"},Ps={class:"summary-content"},Ss=s("h3",null,"訂單摘要",-1),Us={class:"summary-rows"},Ms={class:"summary-row"},Ns=s("span",null,"商品總計",-1),Bs={class:"summary-row"},Ls=s("span",null,"稅金 (5%)",-1),js={key:0,class:"summary-row discount"},Es=s("span",null,"優惠折扣",-1),Fs={class:"coupon-section"},Qs=s("h4",null,"優惠碼",-1),zs={class:"coupon-input"},Os=["placeholder","disabled"],Gs=["disabled"],Hs={key:0},Js={key:1,class:"fas fa-spinner fa-spin"},Ks=s("div",{class:"summary-divider"},null,-1),Ws={class:"summary-row total"},Xs=s("span",null,"總計金額",-1),Ys={class:"price-display"},Zs={key:0,class:"original-price"},Rs={class:"final-price"},Ds={class:"checkout-actions"},se=s("span",null,"前往結帳",-1),ee=s("i",{class:"fas fa-arrow-right"},null,-1),te=s("i",{class:"fas fa-chevron-left"},null,-1),oe=s("span",null,"繼續購物",-1),ae=Z('<div class="secure-checkout"><i class="fas fa-lock"></i><span>安全結帳</span></div><div class="payment-methods"><i class="fab fa-cc-visa"></i><i class="fab fa-cc-mastercard"></i><i class="fab fa-cc-amex"></i><i class="fab fa-cc-jcb"></i></div>',2),le={key:1,class:"empty-cart"},ne={class:"empty-cart-content"},ce=s("i",{class:"fas fa-shopping-cart"},null,-1),ie=s("h3",null,"您的購物車是空的",-1),ue=s("p",null,"瀏覽我們的客房選擇，為您的旅程找到完美的住宿",-1),re=s("span",null,"瀏覽客房",-1),de=s("i",{class:"fas fa-arrow-right"},null,-1),pe=Object.assign({name:"UserCartView"},{__name:"UserCart",setup(_e){const a=W(),x=p(!0),h=q(()=>a.cart),S=q(()=>Math.round((a.cartTotal||0)/1.05)),F=q(()=>(a.cartTotal||0)-S.value),r=p(""),f=p(0),d=p(""),i=p(!1),m=p(!1),C=p(!1),T=p(!1),k=p(0),Q=q(()=>(a.cartTotal||0)-f.value),U=async(e,o)=>{try{x.value=!0,await e()}catch(u){alert(o),console.error(`${o}:`,u)}finally{x.value=!1}},A=async(e,o)=>{o<=0||await U(()=>a.updateCartItem(e,o),"更新數量失敗")},z=e=>{A(e.id,e.qty+1)},O=e=>{e.qty>1&&A(e.id,e.qty-1)},G=async e=>{await U(()=>a.removeCartItem(e),"移除商品失敗")},b=(e,o)=>{d.value=o,C.value=e,T.value=!e,e||(f.value=0,i.value=!1)},M=async()=>{var e,o,u;if(r.value){m.value=!0,d.value="",C.value=!1,T.value=!1;try{const _=await a.applyCoupon(r.value);if(_.success){k.value=a.cartTotal||0;const t=await a.getCart(),v=((e=_.data)==null?void 0:e.final_total)||(t==null?void 0:t.final_total)||a.cartTotal,w=k.value-v;f.value=w>0?w:0;const K=Math.round(w/k.value*100);b(!0,`優惠碼套用成功！您已獲得 ${K}% 的折扣`),i.value=!0}else b(!1,_.message||"優惠碼無效或已過期")}catch(_){b(!1,((u=(o=_.response)==null?void 0:o.data)==null?void 0:u.message)||"優惠碼套用失敗，請稍後再試")}finally{m.value=!1}}},H=async()=>{m.value=!0;try{await a.applyCoupon(""),await a.getCart(),r.value="",f.value=0,k.value=0,i.value=!1,b(!0,"優惠碼已成功移除"),setTimeout(()=>{d.value="",C.value=!1},2e3)}catch(e){console.error("移除優惠碼失敗：",e),b(!1,"移除優惠碼失敗，請稍後再試")}finally{m.value=!1}},y=e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),J=e=>{if(e&&e.final_total!==void 0&&e.total!==void 0&&e.final_total<e.total){k.value=e.total;const o=e.total-e.final_total;f.value=o>0?o:0,i.value=!0,C.value=!0,T.value=!1;const u=Math.round(o/e.total*100);a.couponCode?(r.value=a.couponCode,d.value=`優惠碼套用成功！您已獲得 ${u}% 的折扣`):e.coupon&&e.coupon.code?(r.value=e.coupon.code,d.value=`優惠碼套用成功！您已獲得 ${u}% 的折扣`):e.coupon_code?(r.value=e.coupon_code,d.value=`優惠碼套用成功！您已獲得 ${u}% 的折扣`):d.value=`優惠已套用！您已獲得 ${u}% 的折扣`}};return X(async()=>{try{const e=await a.getCart(),o=localStorage.getItem("autoApplyPromoCode");o&&h.value&&h.value.length>0?(r.value=o,await M(),localStorage.removeItem("autoApplyPromoCode")):J(e)}catch(e){console.error("載入購物車失敗：",e)}finally{x.value=!1}}),(e,o)=>{const u=N("Loading"),_=N("router-link");return l(),n(I,null,[$(u,{active:x.value},null,8,["active"]),s("div",R,[s("div",D,[ss,h.value&&h.value.length>0?(l(),n("div",es,[s("div",ts,[s("div",os,[as,s("div",ls,c(h.value.length)+" 間客房",1)]),s("div",ns,[(l(!0),n(I,null,B(h.value,t=>(l(),n("div",{class:"cart-item",key:t.id},[s("div",cs,[s("img",{src:t.product.imageUrl,alt:t.product.title},null,8,is),us]),s("div",rs,[s("h3",ds,c(t.product.title),1),t.product.description?(l(),n("p",_s,c(t.product.description),1)):g("",!0),t.product.features?(l(),n("div",vs,[(l(!0),n(I,null,B(t.product.features,(v,w)=>(l(),n("span",{key:w,class:"feature-tag"},c(v),1))),128))])):g("",!0)]),s("div",ps,[s("button",{class:"quantity-btn",onClick:v=>O(t),disabled:t.qty<=1},ms,8,hs),L(s("input",{type:"number","onUpdate:modelValue":v=>t.qty=v,min:"1",onChange:v=>A(t.id,t.qty)},null,40,ys),[[j,t.qty,void 0,{number:!0}]]),s("button",{class:"quantity-btn",onClick:v=>z(t)},ks,8,gs)]),s("div",bs,[s("p",ws,[E(c(y(t.product.price))+" 元",1),xs]),s("p",Ts,"小計: "+c(y(t.qty*t.product.price))+" 元",1)]),s("div",qs,[s("button",{class:"remove-btn",onClick:v=>G(t.id)},As,8,$s)])]))),128))])]),s("div",Is,[s("div",Ps,[Ss,s("div",Us,[s("div",Ms,[Ns,s("span",null,c(y(S.value))+" 元",1)]),s("div",Bs,[Ls,s("span",null,c(y(F.value))+" 元",1)]),f.value>0?(l(),n("div",js,[Es,s("span",null,"-"+c(y(f.value))+" 元",1)])):g("",!0)]),s("div",Fs,[Qs,s("div",zs,[L(s("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=t=>r.value=t),placeholder:i.value?"已套用優惠碼":"請輸入優惠碼",disabled:i.value||m.value,class:V({applied:i.value})},null,10,Os),[[j,r.value]]),s("button",{class:V(["apply-coupon",{applied:i.value}]),onClick:M,disabled:!r.value||i.value||m.value},[m.value?(l(),n("i",Js)):(l(),n("span",Hs,c(i.value?"已套用":"套用"),1))],10,Gs)]),d.value?(l(),n("div",{key:0,class:V(["coupon-message",{success:C.value,error:T.value}])},[s("i",{class:V(C.value?"fas fa-check-circle":"fas fa-exclamation-circle")},null,2),E(" "+c(d.value),1)],2)):g("",!0),i.value?(l(),n("button",{key:1,class:"remove-coupon",onClick:H}," 移除優惠碼 ")):g("",!0)]),Ks,s("div",Ws,[Xs,s("div",Ys,[f.value>0?(l(),n("span",Zs,c(y(Y(a).cartTotal))+" 元",1)):g("",!0),s("span",Rs,c(y(Q.value))+" 元",1)])]),s("div",Ds,[$(_,{to:"/user/checkout",class:"checkout-btn"},{default:P(()=>[se,ee]),_:1}),$(_,{to:"/user/products",class:"continue-shopping"},{default:P(()=>[te,oe]),_:1})]),ae])])])):!h.value||h.value.length===0?(l(),n("div",le,[s("div",ne,[ce,ie,ue,$(_,{to:"/user/products",class:"browse-rooms-btn"},{default:P(()=>[re,de]),_:1})])])):g("",!0)])])],64)}}});export{pe as default};
