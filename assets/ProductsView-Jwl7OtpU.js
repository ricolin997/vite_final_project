import{r as f,Q as T,w as L,f as i,g as n,h as e,n as F,t as g,v as m,x as p,F as V,s as I,l as k,k as $,G as N,R as O,u as A,O as B,o as E,e as q,i as G,I as U,M}from"./index-IaK2R5-W.js";import{_ as z}from"./DelModal-BOE6F_4J.js";import{_ as Q}from"./Pagination-wja8j1Sf.js";const R={class:"product-modal"},Y=e("div",{class:"modal-backdrop fade show"},null,-1),H={class:"modal show d-block",tabindex:"-1"},J={class:"modal-dialog modal-xl"},K={class:"modal-content"},W={class:"modal-header"},X={class:"modal-body"},Z={key:0,class:"row"},ee={class:"col-sm-4"},te={class:"mb-3"},se=e("label",{for:"image",class:"form-label"},"輸入首圖網址",-1),oe={class:"image-preview-container"},le=["src"],ae={key:1,class:"no-image"},ie=e("span",null,"尚未設定圖片",-1),ne=[ie],ce={class:"multi-image-container"},re=e("h6",{class:"section-title"},"內容圖片",-1),de={class:"d-flex"},ue=["onUpdate:modelValue"],_e=["onClick"],me=e("i",{class:"bi bi-trash"},null,-1),pe=[me],he={key:0,class:"preview-image"},be=["src"],ge=e("i",{class:"bi bi-plus-circle"},null,-1),fe={class:"file-upload-container"},ve={for:"customFile",class:"form-label"},ye={key:0,class:"bi bi-cloud-upload"},Ue={key:1,class:"bi bi-arrow-repeat spin"},ke={class:"col-sm-8"},$e={class:"mb-3"},we=e("label",{for:"title",class:"form-label"},"標題",-1),Ce={class:"row gx-2"},xe={class:"mb-3 col-md-6"},Pe=e("label",{for:"category",class:"form-label"},"分類",-1),Me={class:"mb-3 col-md-6"},Ve=e("label",{for:"unit",class:"form-label"},"單位",-1),De={class:"row gx-2"},je={class:"mb-3 col-md-6"},Fe=e("label",{for:"origin_price",class:"form-label"},"原價",-1),Ie={class:"mb-3 col-md-6"},Se=e("label",{for:"price",class:"form-label"},"售價",-1),Te={class:"mb-3"},Le=e("label",{for:"description",class:"form-label"},"產品描述",-1),Ne={class:"mb-3"},Oe=e("label",{for:"content",class:"form-label"},"說明內容",-1),Ae={class:"form-check"},Be=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),j=5,Ee=Object.assign({name:"ProductModal"},{__name:"ProductModal",props:{product:{type:Object,required:!0,default:()=>({title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1,imageUrl:"",imagesUrl:[]})}},emits:["close","save"],setup(D,{emit:c}){const v=D,h=c,b=r=>r.length?[...r]:Array(j).fill(""),u=f(!1),_=f(null),t=T({...v.product,imagesUrl:b(v.product.imagesUrl)});L(()=>v.product,r=>{Object.assign(t,{...r,imagesUrl:b(r.imagesUrl)})},{deep:!0});const y=()=>{h("close")},w=()=>{h("save",t)},x=()=>{t.imagesUrl.length<j&&t.imagesUrl.push("")},C=r=>{t.imagesUrl.splice(r,1)},P=async r=>{const o=r.target.files[0];if(!o)return;u.value=!0;const s=new FormData;s.append("file-to-upload",o);try{const d=await O.post("https://vue3-course-api.hexschool.io/api/ricopaul-api/admin/upload",s,{headers:{"Content-Type":"multipart/form-data"}});t.imageUrl=d.data.imageUrl||d.data.url,console.log("上傳成功:",d.data)}catch(a){console.error("圖片上傳失敗:",a)}finally{u.value=!1,_.value&&(_.value.value="")}};return(r,o)=>(i(),n("div",R,[Y,e("div",H,[e("div",J,[e("div",K,[e("div",W,[e("h5",{class:F(["modal-title",{"edit-mode":t.id}])},g(t.id?"編輯產品":"新增產品"),3),e("button",{type:"button",class:"btn-close",onClick:y})]),e("div",X,[t?(i(),n("div",Z,[e("div",ee,[e("div",te,[se,m(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>t.imageUrl=s),type:"text",class:"form-control",id:"image",placeholder:"請輸入圖片連結"},null,512),[[p,t.imageUrl]])]),e("div",oe,[t.imageUrl?(i(),n("img",{key:0,src:t.imageUrl,class:"img-fluid",alt:"產品首圖"},null,8,le)):(i(),n("div",ae,ne))]),e("div",ce,[re,(i(!0),n(V,null,I(t.imagesUrl,(s,a)=>(i(),n("div",{key:a,class:"image-item"},[e("div",de,[m(e("input",{"onUpdate:modelValue":d=>t.imagesUrl[a]=d,type:"url",class:"form-control",placeholder:"請輸入圖片連結"},null,8,ue),[[p,t.imagesUrl[a]]]),e("button",{type:"button",class:"btn-remove",onClick:d=>C(a)},pe,8,_e)]),t.imagesUrl[a]?(i(),n("div",he,[e("img",{src:t.imagesUrl[a],class:"img-fluid",alt:"圖片預覽"},null,8,be)])):k("",!0)]))),128)),e("button",{class:"btn-add-image",onClick:x},[ge,$(" 新增內容圖片 ")]),e("div",fe,[e("label",ve,[$(" 上傳圖片 "),u.value?(i(),n("i",Ue)):(i(),n("i",ye))]),e("input",{type:"file",id:"customFile",class:"form-control",ref_key:"fileInput",ref:_,onChange:P},null,544)])])]),e("div",ke,[e("div",$e,[we,m(e("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>t.title=s),type:"text",class:"form-control",id:"title",placeholder:"請輸入標題"},null,512),[[p,t.title]])]),e("div",Ce,[e("div",xe,[Pe,m(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>t.category=s),type:"text",class:"form-control",id:"category",placeholder:"請輸入分類"},null,512),[[p,t.category]])]),e("div",Me,[Ve,m(e("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>t.unit=s),type:"text",class:"form-control",id:"unit",placeholder:"請輸入單位"},null,512),[[p,t.unit]])])]),e("div",De,[e("div",je,[Fe,m(e("input",{"onUpdate:modelValue":o[4]||(o[4]=s=>t.origin_price=s),type:"number",class:"form-control",id:"origin_price",placeholder:"請輸入原價"},null,512),[[p,t.origin_price]])]),e("div",Ie,[Se,m(e("input",{"onUpdate:modelValue":o[5]||(o[5]=s=>t.price=s),type:"number",class:"form-control",id:"price",placeholder:"請輸入售價"},null,512),[[p,t.price]])])]),e("div",Te,[Le,m(e("textarea",{"onUpdate:modelValue":o[6]||(o[6]=s=>t.description=s),class:"form-control",id:"description",placeholder:"請輸入產品描述"},null,512),[[p,t.description]])]),e("div",Ne,[Oe,m(e("textarea",{"onUpdate:modelValue":o[7]||(o[7]=s=>t.content=s),class:"form-control",id:"content",placeholder:"請輸入產品說明內容"},null,512),[[p,t.content]])]),e("div",Ae,[m(e("input",{"onUpdate:modelValue":o[8]||(o[8]=s=>t.is_enabled=s),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled"},null,512),[[N,t.is_enabled]]),Be])])])):k("",!0)]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-cancel",onClick:y},"取消"),e("button",{type:"button",class:"btn btn-save",onClick:w},"確認")])])])])]))}}),qe={class:"products-management"},Ge={class:"d-flex justify-content-between align-items-center mb-4"},ze=e("h2",null,"商品管理",-1),Qe=e("i",{class:"bi bi-plus-circle"},null,-1),Re={key:0,class:"empty-state"},Ye=e("div",{class:"empty-icon"},[e("i",{class:"bi bi-inbox"})],-1),He=e("div",{class:"empty-text"},"目前沒有商品，請點擊「新增產品」按鈕來添加",-1),Je=[Ye,He],Ke={key:1,class:"table products-table"},We=e("thead",null,[e("tr",null,[e("th",{width:"120"},"分類"),e("th",null,"產品名稱"),e("th",{width:"120"},"原價"),e("th",{width:"120"},"售價"),e("th",{width:"100"},"是否啟用"),e("th",{width:"200"},"編輯")])],-1),Xe={class:"product-category"},Ze={class:"product-title"},et={class:"product-price original text-right"},tt={class:"product-price current text-right"},st={class:"product-status"},ot={class:"btn-group"},lt=["onClick"],at=e("i",{class:"bi bi-pencil-square"},null,-1),it=["onClick"],nt=e("i",{class:"bi bi-trash"},null,-1),ut={__name:"ProductsView",setup(D){const c=A(),v=B("emitter"),h=f(!1),b=f(!1),u=f(null),_=f(!1),t=s=>{v.emit("show-toast",s)},y=s=>{u.value=s?{...s,imagesUrl:Array.isArray(s.imagesUrl)&&s.imagesUrl.length?[...s.imagesUrl]:["","","","",""]}:{title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:1,imageUrl:"",imagesUrl:["","","","",""]},h.value=!0},w=()=>{h.value=!1,u.value=null},x=s=>{u.value=s,b.value=!0},C=()=>{b.value=!1,u.value=null},P=async()=>{C(),await c.getProducts(),t({style:"error",title:"產品刪除成功"})},r=async s=>{var a,d;_.value=!0;try{let l;s.id?(l=await c.updateProduct(s),l.data.success?(await c.getProducts(),t({style:"success",title:"產品更新成功"})):t({style:"error",title:"產品更新失敗",content:l.data.message.join("、")})):(l=await c.createProduct(s),l.data.success?(await c.getProducts(),t({style:"success",title:"產品建立成功"})):t({style:"error",title:"產品建立失敗",content:l.data.message.join("、")}))}catch(l){t({style:"error",title:"操作失敗",content:((d=(a=l.response)==null?void 0:a.data)==null?void 0:d.message)||"發生未知錯誤"})}finally{_.value=!1,w()}},o=async(s=1)=>{_.value=!0;try{await c.getProducts(s)}catch(a){console.error("Failed to fetch products:",a),t({style:"error",title:"取得產品失敗",content:a.message})}finally{_.value=!1}};return E(()=>{o()}),(s,a)=>{const d=q("Loading");return i(),n(V,null,[G(d,{active:_.value},null,8,["active"]),e("div",qe,[e("div",Ge,[ze,e("button",{class:"btn btn-add-product",onClick:a[0]||(a[0]=l=>y(null))},[Qe,$(" 新增產品 ")])]),U(c).products.length===0&&!_.value?(i(),n("div",Re,Je)):(i(),n("table",Ke,[We,e("tbody",null,[(i(!0),n(V,null,I(U(c).products,l=>(i(),n("tr",{key:l.id},[e("td",Xe,g(l.category),1),e("td",Ze,g(l.title),1),e("td",et," $"+g(s.$formatPrice(l.origin_price)),1),e("td",tt,"$"+g(s.$formatPrice(l.price)),1),e("td",st,[e("span",{class:F(["status-badge",l.is_enabled?"enabled":"disabled"])},g(l.is_enabled?"啟用":"未啟用"),3)]),e("td",null,[e("div",ot,[e("button",{class:"btn btn-edit",onClick:S=>y(l)},[at,$(" 編輯 ")],8,lt),e("button",{class:"btn btn-delete",onClick:S=>x(l)},[nt,$(" 刪除 ")],8,it)])])]))),128))])])),U(c).pagination.total_pages>1?(i(),M(Q,{key:2,pages:U(c).pagination,onEmitPages:o},null,8,["pages"])):k("",!0),h.value?(i(),M(Ee,{key:3,product:u.value,onClose:w,onSave:r},null,8,["product"])):k("",!0),b.value?(i(),M(z,{key:4,item:u.value,entityName:"產品",onDelete:U(c).deleteProduct,onClose:C,onDeleted:P},null,8,["item","onDelete"])):k("",!0)])],64)}}};export{ut as default};
