import{f as i,g as _,h as e,t as d,n as L,l as y,F as M,s as S,O as B,r as $,q as H,v as f,y as J,x as g,u as K,o as Q,e as R,i as X,k as w,I as k,M as C}from"./index-IaK2R5-W.js";import{_ as Y}from"./Pagination-wja8j1Sf.js";import{_ as A}from"./DelModal-BOE6F_4J.js";const Z={class:"order-details-modal"},ee=e("div",{class:"modal-backdrop fade show"},null,-1),se={class:"modal show",tabindex:"-1",style:{display:"block"}},te={class:"modal-dialog"},oe={class:"modal-content"},le=e("h5",{class:"modal-title"},"訂單詳細資料",-1),ae={class:"modal-body"},de={class:"order-header"},ie={class:"order-info"},ne={class:"order-id"},ce={class:"order-date"},re={class:"order-status"},ue=e("h6",{class:"section-title"},"顧客資訊",-1),_e={class:"customer-info"},me={class:"info-grid"},he={class:"info-item"},ve=e("div",{class:"label"},"姓名",-1),be={class:"value"},pe={class:"info-item"},$e=e("div",{class:"label"},"電話",-1),fe={class:"value"},ye={class:"info-item"},ge=e("div",{class:"label"},"地址",-1),we={class:"value"},ke={key:0,class:"info-item"},Ce=e("div",{class:"label"},"付款方式",-1),De={class:"value"},Oe={key:0,class:"message"},Me=e("div",{class:"label"},"留言",-1),xe={class:"value"},Ve=e("h6",{class:"section-title"},"產品列表",-1),qe={class:"products-list"},Ee={class:"product-info"},Ue={class:"product-title"},Ne={class:"product-qty"},Ae={class:"product-price"},Le=e("h6",{class:"section-title"},"訂單摘要",-1),Se={class:"order-summary"},Be={class:"summary-item"},Pe=e("div",{class:"label"},"總計",-1),Te={class:"value total"},je={__name:"OrderDetailsModal",props:{order:{type:Object,required:!0}},emits:["close"],setup(a,{emit:r}){const n=r,b=s=>s?new Date(s*1e3).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"無日期資料",c=()=>{n("close")};return(s,h)=>(i(),_("div",Z,[ee,e("div",se,[e("div",te,[e("div",oe,[e("div",{class:"modal-header"},[le,e("button",{type:"button",class:"btn-close",onClick:c})]),e("div",ae,[e("div",de,[e("div",ie,[e("div",ne,"訂單編號: "+d(a.order.id),1),e("div",ce,"訂單日期: "+d(b(a.order.create_at)),1)]),e("div",re,[e("span",{class:L(["status-badge",a.order.is_paid?"paid":"unpaid"])},d(a.order.is_paid?"已付款":"未付款"),3)])]),ue,e("div",_e,[e("div",me,[e("div",he,[ve,e("div",be,d(a.order.user.name),1)]),e("div",pe,[$e,e("div",fe,d(a.order.user.tel),1)]),e("div",ye,[ge,e("div",we,d(a.order.user.address),1)]),a.order.payment_method?(i(),_("div",ke,[Ce,e("div",De,d(a.order.payment_method),1)])):y("",!0)]),a.order.message?(i(),_("div",Oe,[Me,e("div",xe,d(a.order.message),1)])):y("",!0)]),Ve,e("div",qe,[(i(!0),_(M,null,S(a.order.products,u=>(i(),_("div",{class:"product-item",key:u.id},[e("div",Ee,[e("div",Ue,d(u.product.title),1),e("div",Ne,"x "+d(u.qty),1)]),e("div",Ae,"$"+d(s.$formatPrice(u.total)),1)]))),128))]),Le,e("div",Se,[e("div",Be,[Pe,e("div",Te,"$"+d(s.$formatPrice(a.order.total)),1)])])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn-secondary",onClick:c},"關閉")])])])])]))}},ze={class:"edit-order-modal"},Fe=e("div",{class:"modal-backdrop fade show"},null,-1),Ie={class:"modal fade show d-block",tabindex:"-1"},We={class:"modal-dialog modal-lg"},Ge={class:"modal-content"},He=e("h5",{class:"modal-title"},"編輯訂單",-1),Je={class:"modal-body"},Ke={class:"row"},Qe={class:"col-md-6 mb-3"},Re=e("label",{class:"form-label"},"訂單編號",-1),Xe=["value"],Ye={class:"col-md-6 mb-3"},Ze=e("label",{class:"form-label"},"付款狀態",-1),es=e("option",{value:!0},"已付款",-1),ss=e("option",{value:!1},"未付款",-1),ts=[es,ss],os=e("h6",{class:"section-title"},"用戶資訊",-1),ls={class:"row"},as={class:"col-md-6 mb-3"},ds=e("label",{class:"form-label"},"用戶姓名",-1),is={class:"col-md-6 mb-3"},ns=e("label",{class:"form-label"},"用戶電話",-1),cs={class:"mb-3"},rs=e("label",{class:"form-label"},"用戶信箱",-1),us={class:"mb-3"},_s=e("label",{class:"form-label"},"用戶地址",-1),ms=e("h6",{class:"section-title"},"訂單詳情",-1),hs={class:"mb-3"},vs=e("label",{class:"form-label"},"總金額",-1),bs={class:"input-group"},ps=e("span",{class:"input-group-text"},"$",-1),$s={class:"mb-3"},fs=e("label",{class:"form-label"},"備註",-1),ys=e("button",{type:"submit",class:"btn-primary"},"更新訂單",-1),gs={__name:"EditOrderModal",props:{order:{type:Object,required:!0}},emits:["close","update"],setup(a,{emit:r}){const n=a,b=r,c=B("emitter"),s=$({id:n.order.id,is_paid:n.order.is_paid,total:n.order.total,create_at:n.order.create_at,message:n.order.message||"",payment_method:n.order.payment_method||"",user:{...n.order.user},products:n.order.products||[]}),h=(D,t)=>{c.emit("show-toast",{style:"danger",title:D,content:t})},u=()=>{b("close")},p=()=>{if(!s.value.total||s.value.total<=0){h("驗證錯誤","請輸入有效的總金額");return}if(!s.value.user.name||!s.value.user.email){h("驗證錯誤","請填寫用戶姓名和信箱");return}b("update",s.value)};return(D,t)=>(i(),_("div",ze,[Fe,e("div",Ie,[e("div",We,[e("div",Ge,[e("div",{class:"modal-header"},[He,e("button",{type:"button",class:"btn-close",onClick:u})]),e("div",Je,[e("form",{onSubmit:H(p,["prevent"])},[e("div",Ke,[e("div",Qe,[Re,e("input",{type:"text",class:"form-control",value:a.order.id,disabled:""},null,8,Xe)]),e("div",Ye,[Ze,f(e("select",{class:"form-select","onUpdate:modelValue":t[0]||(t[0]=o=>s.value.is_paid=o)},ts,512),[[J,s.value.is_paid]])])]),os,e("div",ls,[e("div",as,[ds,f(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=o=>s.value.user.name=o),required:""},null,512),[[g,s.value.user.name]])]),e("div",is,[ns,f(e("input",{type:"tel",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=o=>s.value.user.tel=o),required:""},null,512),[[g,s.value.user.tel]])])]),e("div",cs,[rs,f(e("input",{type:"email",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=o=>s.value.user.email=o),required:""},null,512),[[g,s.value.user.email]])]),e("div",us,[_s,f(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=o=>s.value.user.address=o),required:""},null,512),[[g,s.value.user.address]])]),ms,e("div",hs,[vs,e("div",bs,[ps,f(e("input",{type:"number",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=o=>s.value.total=o),required:""},null,512),[[g,s.value.total,void 0,{number:!0}]])])]),e("div",$s,[fs,f(e("textarea",{class:"form-control","onUpdate:modelValue":t[6]||(t[6]=o=>s.value.message=o),rows:"3"},null,512),[[g,s.value.message]])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn-secondary",onClick:u},"取消"),ys])],32)])])])])]))}},ws={class:"orders-management"},ks=e("h2",null,"訂單管理",-1),Cs={class:"action-buttons"},Ds=e("i",{class:"bi bi-arrow-clockwise"},null,-1),Os=["disabled"],Ms=e("i",{class:"bi bi-trash"},null,-1),xs={key:0,class:"empty-state"},Vs=e("div",{class:"empty-icon"},[e("i",{class:"bi bi-inbox"})],-1),qs=e("div",{class:"empty-text"},"目前沒有訂單資料",-1),Es=[Vs,qs],Us={key:1,class:"table orders-table"},Ns=e("thead",null,[e("tr",null,[e("th",null,"訂單編號"),e("th",null,"用戶姓名"),e("th",null,"電話"),e("th",null,"總金額"),e("th",null,"狀態"),e("th",null,"操作")])],-1),As={class:"order-id"},Ls={class:"customer-name"},Ss={class:"customer-tel"},Bs={class:"order-total"},Ps={class:"order-status"},Ts={class:"action-buttons"},js=["onClick"],zs=e("i",{class:"bi bi-eye"},null,-1),Fs=["onClick","disabled"],Is=e("i",{class:"bi bi-pencil-square"},null,-1),Ws=["onClick","disabled"],Gs=e("i",{class:"bi bi-trash"},null,-1),Qs={__name:"OrdersView",setup(a){const r=K(),n=$(!1),b=$(null),c=$(!1),s=$(!1),h=$(!1),u=$(!1),p=$(null),D=B("emitter"),t=(l,v,O)=>{D.emit("show-toast",{style:l,title:v,content:O})},o=async(l=1)=>{c.value=!0;try{await r.getOrders(l)}catch(v){console.error("取得訂單失敗:",v),t("error","取得訂單失敗",v.message||"請稍後再試")}finally{c.value=!1}},P=l=>{b.value=l,n.value=!0},T=()=>{b.value=null,n.value=!1},j=l=>{p.value={...l},s.value=!0},x=()=>{p.value=null,s.value=!1},z=async l=>{c.value=!0;try{await r.updateOrder(l),await o(),t("success","訂單更新成功","訂單資料已成功更新"),x()}catch(v){t("error","更新失敗",v.message||"訂單更新出現錯誤")}finally{c.value=!1}},F=l=>{p.value={...l},h.value=!0},V=()=>{p.value=null,h.value=!1},I=()=>{u.value=!0},q=()=>{u.value=!1},W=async l=>{const v=`https://vue3-course-api.hexschool.io/api/ricopaul-api/admin/order/${l}`;await r.deleteOrder(v),await o()},G=async()=>{await r.deleteAllOrders("https://vue3-course-api.hexschool.io/api/ricopaul-api/admin/orders/all"),await o()},E=()=>{t("success","刪除成功","訂單已成功刪除"),V(),q()},U=l=>{t("error","刪除失敗",l||"刪除訂單時發生錯誤")};return Q(()=>{o()}),(l,v)=>{const O=R("Loading");return i(),_(M,null,[X(O,{active:c.value},null,8,["active"]),e("div",ws,[ks,e("div",Cs,[e("button",{class:"btn-refresh",onClick:o},[Ds,w(" 重新整理 ")]),e("button",{class:"btn-delete-all",onClick:I,disabled:c.value||!k(r).orders.length},[Ms,w(" 刪除全部訂單 ")],8,Os)]),k(r).orders.length===0&&!c.value?(i(),_("div",xs,Es)):(i(),_("table",Us,[Ns,e("tbody",null,[(i(!0),_(M,null,S(k(r).orders,m=>(i(),_("tr",{key:m.id},[e("td",As,d(m.id),1),e("td",Ls,d(m.user.name),1),e("td",Ss,d(m.user.tel),1),e("td",Bs,"$"+d(l.$formatPrice(m.total)),1),e("td",Ps,[e("span",{class:L(["status-badge",m.is_paid?"paid":"unpaid"])},d(m.is_paid?"已付款":"未付款"),3)]),e("td",null,[e("div",Ts,[e("button",{class:"btn btn-view",onClick:N=>P(m)},[zs,w(" 檢視 ")],8,js),e("button",{class:"btn btn-edit",onClick:N=>j(m),disabled:c.value},[Is,w(" 編輯 ")],8,Fs),e("button",{class:"btn btn-delete",onClick:N=>F(m),disabled:c.value},[Gs,w(" 刪除 ")],8,Ws)])])]))),128))])])),k(r).pagination.total_pages>1?(i(),C(Y,{key:2,pages:k(r).pagination,onEmitPages:o},null,8,["pages"])):y("",!0),n.value?(i(),C(je,{key:3,order:b.value,onClose:T},null,8,["order"])):y("",!0),s.value?(i(),C(gs,{key:4,order:p.value,onClose:x,onUpdate:z},null,8,["order"])):y("",!0),h.value?(i(),C(A,{key:5,show:h.value,item:p.value,entityName:"訂單",onDelete:W,onClose:V,onDeleted:E,onError:U},null,8,["show","item"])):y("",!0),u.value?(i(),C(A,{key:6,show:u.value,item:{title:"全部"},entityName:"訂單",onDelete:G,onClose:q,onDeleted:E,onError:U},null,8,["show"])):y("",!0)])],64)}}};export{Qs as default};
