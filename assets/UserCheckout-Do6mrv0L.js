import{u as P,b as Y,r as m,c as x,o as $,e as S,f as n,g as i,i as V,h as e,q as z,v as c,x as u,n as B,l as p,j as U,k,t as v,F as N,s as D,m as T}from"./index-IaK2R5-W.js";const R={class:"user-checkout"},W={class:"container"},G=e("div",{class:"checkout-header"},[e("h2",null,"完成您的預訂"),e("p",{class:"subtitle"},"請填寫以下資訊以確認您的奢華住宿體驗")],-1),J={class:"checkout-content"},K={class:"checkout-form-container"},Q=e("div",{class:"form-header"},[e("h3",null,"訂購資訊"),e("div",{class:"secure-info"},[e("i",{class:"fas fa-lock"}),e("span",null,"安全加密")])],-1),X={class:"form-group"},Z=e("label",{for:"name"},"姓名",-1),ee={class:"form-row"},se={class:"form-group"},te=e("label",{for:"email"},"電子郵件",-1),ae={class:"form-group"},le=e("label",{for:"tel"},"聯絡電話",-1),oe={class:"form-group"},re=e("label",{for:"address"},"地址",-1),ne={class:"form-group"},ie=e("label",{for:"message"},"特殊需求或備註",-1),de=e("div",{class:"form-divider"},null,-1),ce={class:"payment-section"},ue=e("h4",null,"付款方式",-1),ve={class:"payment-methods"},_e={class:"method-radio"},me={key:0,class:"radio-inner"},pe=T('<div class="method-info"><span>信用卡付款</span><div class="card-icons"><i class="fab fa-cc-visa"></i><i class="fab fa-cc-mastercard"></i><i class="fab fa-cc-amex"></i><i class="fab fa-cc-jcb"></i></div></div>',1),he={class:"method-radio"},fe={key:0,class:"radio-inner"},ye=e("div",{class:"method-info"},[e("span",null,"銀行轉帳")],-1),ge={key:0,class:"credit-card-form"},be={class:"form-row"},xe={class:"form-group full-width"},ke=e("label",{for:"card-number"},"卡號",-1),we={class:"form-row"},Ve={class:"form-group"},Me=e("label",{for:"card-name"},"持卡人姓名",-1),Ce={class:"form-group card-expiry"},Ue=e("label",{for:"card-expiry"},"有效期限",-1),qe={class:"form-group card-cvv"},Ie=e("label",{for:"card-cvv"},"CVV",-1),Se={key:1,class:"bank-transfer-info"},Be=T('<p>請在完成訂單後，將款項轉帳至以下帳戶：</p><div class="bank-details"><div class="bank-detail-item"><span class="label">銀行名稱：</span><span class="value">SHIBA國際銀行</span></div><div class="bank-detail-item"><span class="label">帳戶名稱：</span><span class="value">SHIBA奢華酒店</span></div><div class="bank-detail-item"><span class="label">帳號：</span><span class="value">1234-5678-9012-3456</span></div></div><p class="note"> * 請在轉帳備註中填寫您的訂單號碼，我們將在確認款項後處理您的訂單。 </p>',3),Ne=[Be],Te={class:"form-actions"},Ee=e("button",{type:"submit",class:"submit-btn"},[e("span",null,"確認訂單"),e("i",{class:"fas fa-check-circle"})],-1),Le=e("i",{class:"fas fa-arrow-left"},null,-1),Oe=e("span",null,"返回購物車",-1),je={key:0,class:"error-message"},Ae=e("i",{class:"fas fa-exclamation-circle"},null,-1),Fe={class:"order-summary"},He={class:"summary-content"},Pe=e("h3",null,"訂單摘要",-1),Ye={class:"order-items"},$e={class:"item-image"},ze=["src","alt"],De={class:"item-info"},Re={class:"item-details"},We={class:"quantity"},Ge={class:"price"},Je=e("div",{class:"summary-divider"},null,-1),Ke={class:"summary-rows"},Qe={class:"summary-row"},Xe=e("span",null,"商品總計",-1),Ze={class:"summary-row"},es=e("span",null,"稅金 (5%)",-1),ss={key:0,class:"summary-row discount"},ts=e("span",null,"優惠折扣",-1),as=e("div",{class:"summary-divider"},null,-1),ls={class:"summary-row total"},os=e("span",null,"總計金額",-1),rs={class:"price-display"},ns={key:0,class:"original-price"},is={class:"final-price"},ds={class:"terms-agreement"},vs={__name:"UserCheckout",setup(cs){const w=P(),M=Y(),f=m(!1),y=m(""),r=m("credit"),o=m({name:"",email:"",tel:"",address:"",message:""}),l=m({number:"",name:"",expiry:"",cvv:""}),g=x(()=>w.cart||[]),C=x(()=>w.cartTotal||0),q=x(()=>Math.round(C.value/1.05)),E=x(()=>C.value-q.value),b=m(0),I=m(0),L=x(()=>C.value-b.value),O=()=>{let s=l.value.number.replace(/\D/g,""),t="";for(let d=0;d<s.length;d++)d>0&&d%4===0&&(t+=" "),t+=s[d];l.value.number=t},j=()=>{let s=l.value.expiry.replace(/\D/g,"");s.length>2?l.value.expiry=s.substring(0,2)+"/"+s.substring(2):l.value.expiry=s},h=s=>s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),A=()=>!g.value||g.value.length===0?{valid:!1,errorMsg:"購物車是空的，請先添加商品"}:!o.value.name||!o.value.email||!o.value.tel||!o.value.address?{valid:!1,errorMsg:"請填寫所有必填欄位"}:r.value==="credit"&&(!l.value.number||!l.value.name||!l.value.expiry||!l.value.cvv)?{valid:!1,errorMsg:"請填寫完整的信用卡資訊"}:{valid:!0,errorMsg:""},F=async()=>{y.value="",f.value=!0;try{const{valid:s,errorMsg:t}=A();if(!s)throw new Error(t);const d={...o.value,paymentMethod:r.value},_=await w.createOrder(d);if(!_||!_.orderId)throw new Error("訂單建立失敗，請重試");M.push({path:"/user/order-success",query:{orderId:_.orderId}})}catch(s){console.error("訂單建立失敗：",s),y.value=s.message||"訂單建立失敗，請重試"}finally{f.value=!1}},H=s=>{s&&s.final_total!==void 0&&s.total!==void 0&&s.final_total<s.total&&(I.value=s.total,b.value=s.total-s.final_total)};return $(async()=>{f.value=!0;try{const s=await w.getCart();if(!g.value||g.value.length===0){M.push("/user/products");return}H(s)}catch(s){console.error("獲取購物車資料失敗：",s),y.value="獲取購物車資料失敗",M.push("/user/products")}finally{f.value=!1}}),(s,t)=>{const d=S("Loading"),_=S("router-link");return n(),i(N,null,[V(d,{active:f.value},null,8,["active"]),e("div",R,[e("div",W,[G,e("div",J,[e("div",K,[Q,e("form",{onSubmit:z(F,["prevent"]),class:"checkout-form"},[e("div",X,[Z,c(e("input",{type:"text",id:"name","onUpdate:modelValue":t[0]||(t[0]=a=>o.value.name=a),placeholder:"請輸入您的姓名",required:""},null,512),[[u,o.value.name]])]),e("div",ee,[e("div",se,[te,c(e("input",{type:"email",id:"email","onUpdate:modelValue":t[1]||(t[1]=a=>o.value.email=a),placeholder:"example@email.com",required:""},null,512),[[u,o.value.email]])]),e("div",ae,[le,c(e("input",{type:"tel",id:"tel","onUpdate:modelValue":t[2]||(t[2]=a=>o.value.tel=a),placeholder:"請輸入您的聯絡電話",required:""},null,512),[[u,o.value.tel]])])]),e("div",oe,[re,c(e("input",{type:"text",id:"address","onUpdate:modelValue":t[3]||(t[3]=a=>o.value.address=a),placeholder:"請輸入您的詳細地址",required:""},null,512),[[u,o.value.address]])]),e("div",ne,[ie,c(e("textarea",{id:"message","onUpdate:modelValue":t[4]||(t[4]=a=>o.value.message=a),placeholder:"若您有任何特殊需求或備註，請在此說明",rows:"4"},null,512),[[u,o.value.message]])]),de,e("div",ce,[ue,e("div",ve,[e("div",{class:B(["payment-method",{active:r.value==="credit"}]),onClick:t[5]||(t[5]=a=>r.value="credit")},[e("div",_e,[r.value==="credit"?(n(),i("div",me)):p("",!0)]),pe],2),e("div",{class:B(["payment-method",{active:r.value==="transfer"}]),onClick:t[6]||(t[6]=a=>r.value="transfer")},[e("div",he,[r.value==="transfer"?(n(),i("div",fe)):p("",!0)]),ye],2)]),r.value==="credit"?(n(),i("div",ge,[e("div",be,[e("div",xe,[ke,c(e("input",{type:"text",id:"card-number","onUpdate:modelValue":t[7]||(t[7]=a=>l.value.number=a),placeholder:"1234 5678 9012 3456",maxlength:"19",onInput:O},null,544),[[u,l.value.number]])])]),e("div",we,[e("div",Ve,[Me,c(e("input",{type:"text",id:"card-name","onUpdate:modelValue":t[8]||(t[8]=a=>l.value.name=a),placeholder:"請輸入持卡人姓名"},null,512),[[u,l.value.name]])]),e("div",Ce,[Ue,c(e("input",{type:"text",id:"card-expiry","onUpdate:modelValue":t[9]||(t[9]=a=>l.value.expiry=a),placeholder:"MM/YY",maxlength:"5",onInput:j},null,544),[[u,l.value.expiry]])]),e("div",qe,[Ie,c(e("input",{type:"text",id:"card-cvv","onUpdate:modelValue":t[10]||(t[10]=a=>l.value.cvv=a),placeholder:"123",maxlength:"3"},null,512),[[u,l.value.cvv]])])])])):p("",!0),r.value==="transfer"?(n(),i("div",Se,Ne)):p("",!0)]),e("div",Te,[Ee,V(_,{to:"/user/cart",class:"back-to-cart"},{default:U(()=>[Le,Oe]),_:1})]),y.value?(n(),i("div",je,[Ae,k(" "+v(y.value),1)])):p("",!0)],32)]),e("div",Fe,[e("div",He,[Pe,e("div",Ye,[(n(!0),i(N,null,D(g.value,a=>(n(),i("div",{class:"order-item",key:a.id},[e("div",$e,[e("img",{src:a.product.imageUrl,alt:a.product.title},null,8,ze)]),e("div",De,[e("h4",null,v(a.product.title),1),e("div",Re,[e("span",We,v(a.qty)+" 晚",1),e("span",Ge,v(h(a.qty*a.product.price))+" 元",1)])])]))),128))]),Je,e("div",Ke,[e("div",Qe,[Xe,e("span",null,v(h(q.value))+" 元",1)]),e("div",Ze,[es,e("span",null,v(h(E.value))+" 元",1)]),b.value>0?(n(),i("div",ss,[ts,e("span",null,"-"+v(h(b.value))+" 元",1)])):p("",!0)]),as,e("div",ls,[os,e("div",rs,[b.value>0?(n(),i("span",ns,v(h(I.value))+" 元",1)):p("",!0),e("span",is,v(h(L.value))+" 元",1)])]),e("div",ds,[e("p",null,[k(" 完成訂單即表示您同意我們的"),V(_,{to:"/privacy"},{default:U(()=>[k("隱私政策")]),_:1}),k("和"),V(_,{to:"/terms"},{default:U(()=>[k("使用條款")]),_:1})])])])])])])])],64)}}};export{vs as default};
