import{r as h,c as E,w as L,f as i,g as _,l as g,h as e,t as b,v as m,x as y,G as N,u as q,O as F,o as O,e as P,i as j,k,I as v,F as V,s as z,M as D,n as I}from"./index-IaK2R5-W.js";import{_ as G}from"./Pagination-wja8j1Sf.js";import{_ as R}from"./DelModal-BOE6F_4J.js";const W={class:"coupon-modal"},A={key:0,class:"modal-backdrop fade show"},H={class:"modal fade show d-block",tabindex:"-1",role:"dialog"},J={class:"modal-dialog"},K={class:"modal-content"},Q={class:"modal-header"},X={class:"modal-title"},Y={class:"modal-body"},Z={class:"mb-3"},ee=e("label",{class:"form-label"},"優惠券名稱",-1),te={class:"mb-3"},se=e("label",{class:"form-label"},"折扣碼",-1),oe={class:"mb-3"},le=e("label",{class:"form-label"},"折扣百分比",-1),ae={class:"mb-3"},ne=e("label",{class:"form-label"},"到期日",-1),ce={class:"form-check"},de=e("label",{class:"form-check-label",for:"couponEnabled"},"啟用此優惠券",-1),ie={__name:"CouponModal",props:{coupon:{type:Object,default:()=>({title:"",code:"",percent:0,due_date:null,is_enabled:0})},showBackdrop:{type:Boolean,default:!1}},emits:["close","save"],setup(C,{emit:c}){const u=C,p=c,t=h({...u.coupon}),f=E({get(){return t.value.due_date?new Date(t.value.due_date*1e3).toISOString().split("T")[0]:""},set(a){a?t.value.due_date=Math.floor(new Date(a).getTime()/1e3):t.value.due_date=null}});L(()=>u.coupon,a=>{t.value={...a}},{immediate:!0});const r=()=>{p("close")},$=()=>{t.value.due_date&&(t.value.due_date=Math.floor(t.value.due_date)),t.value.is_enabled=t.value.is_enabled?1:0,p("save",t.value)};return(a,o)=>(i(),_("div",W,[C.showBackdrop?(i(),_("div",A)):g("",!0),e("div",H,[e("div",J,[e("div",K,[e("div",Q,[e("h5",X,b(t.value.id?"編輯優惠券":"新增優惠券"),1),e("button",{type:"button",class:"btn-close",onClick:r})]),e("div",Y,[e("div",Z,[ee,m(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=l=>t.value.title=l),placeholder:"請輸入優惠券名稱",required:""},null,512),[[y,t.value.title]])]),e("div",te,[se,m(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=l=>t.value.code=l),placeholder:"例如：SUMMER2023",required:""},null,512),[[y,t.value.code]])]),e("div",oe,[le,m(e("input",{type:"number",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=l=>t.value.percent=l),min:"1",max:"100",placeholder:"請輸入1-100之間的數字",required:""},null,512),[[y,t.value.percent]])]),e("div",ae,[ne,m(e("input",{type:"date",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=l=>f.value=l)},null,512),[[y,f.value]])]),e("div",ce,[m(e("input",{type:"checkbox",class:"form-check-input",id:"couponEnabled","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=l=>t.value.is_enabled=l)},null,512),[[N,t.value.is_enabled]]),de])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn-secondary",onClick:r},"取消"),e("button",{type:"button",class:"btn-primary",onClick:$},"儲存優惠券")])])])])]))}},ue={class:"coupons-management"},re={class:"page-header"},_e=e("h2",null,"優惠券管理",-1),pe={class:"action-buttons"},me=e("i",{class:"bi bi-plus-circle"},null,-1),ve={key:0,class:"empty-state"},he=e("div",{class:"empty-icon"},[e("i",{class:"bi bi-ticket-perforated"})],-1),be=e("div",{class:"empty-text"},"目前沒有優惠券資料",-1),fe=e("i",{class:"bi bi-plus-circle"},null,-1),ye={key:1,class:"coupons-table"},ke=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"啟用狀態"),e("th",null,"操作")])],-1),ge={class:"coupon-title"},Ce={class:"coupon-percent"},$e={class:"coupon-date"},we={class:"action-buttons"},De=["onClick"],Me=e("i",{class:"bi bi-pencil-square"},null,-1),xe=["onClick"],Ve=e("i",{class:"bi bi-trash"},null,-1),Ue={__name:"CouponsView",setup(C){const c=q(),u=h(!1),p=h(!1),t=h(null),f=F("emitter"),r=h(!1),$=s=>s?new Date(s*1e3).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):"未設定",a=(s,n,w="")=>{f.emit("show-toast",{style:s,title:n,content:w})},o=async(s=1)=>{r.value=!0;try{await c.getCoupons(s)}catch(n){console.error("Failed to fetch coupons:",n),a("error","無法載入優惠券",n.message)}finally{r.value=!1}},l=s=>{t.value=s?{...s}:{title:"",code:"",percent:0,due_date:"",is_enabled:0},u.value=!0},M=()=>{u.value=!1,t.value=null},B=async s=>{try{s.id?await c.updateCoupon(s):await c.createCoupon(s),await o(),M(),a("success","更新優惠券成功")}catch(n){a("error","操作失敗",n.message)}},S=s=>{t.value={...s},p.value=!0},x=()=>{p.value=!1,t.value=null},T=async()=>{try{await o(),x(),a("success","優惠券刪除成功")}catch(s){a("error","操作失敗",s.message)}};return O(()=>{o()}),(s,n)=>{const w=P("Loading");return i(),_(V,null,[j(w,{active:r.value},null,8,["active"]),e("div",ue,[e("div",re,[_e,e("div",pe,[e("button",{class:"btn-add-coupon",onClick:n[0]||(n[0]=d=>l(null))},[me,k(" 新增優惠券 ")])])]),v(c).coupons.length===0&&!r.value?(i(),_("div",ve,[he,be,e("button",{class:"btn-add-first",onClick:n[1]||(n[1]=d=>l(null))},[fe,k(" 新增第一張優惠券 ")])])):(i(),_("table",ye,[ke,e("tbody",null,[(i(!0),_(V,null,z(v(c).coupons,d=>(i(),_("tr",{key:d.id},[e("td",ge,b(d.title),1),e("td",Ce,b(d.percent)+"%",1),e("td",$e,b($(d.due_date)),1),e("td",null,[e("span",{class:I(["coupon-status",d.is_enabled?"enabled":"disabled"])},b(d.is_enabled?"啟用":"未啟用"),3)]),e("td",null,[e("div",we,[e("button",{class:"btn-edit",onClick:U=>l(d)},[Me,k(" 編輯 ")],8,De),e("button",{class:"btn-delete",onClick:U=>S(d)},[Ve,k(" 刪除 ")],8,xe)])])]))),128))])])),v(c).couponPagination.total_pages>1?(i(),D(G,{key:2,pages:v(c).couponPagination,onEmitPages:o},null,8,["pages"])):g("",!0),u.value?(i(),D(ie,{key:3,coupon:t.value,showBackdrop:u.value,onClose:M,onSave:B},null,8,["coupon","showBackdrop"])):g("",!0),p.value?(i(),D(R,{key:4,item:t.value,entityName:"優惠券",onDelete:v(c).deleteCoupon,onClose:x,onDeleted:T},null,8,["item","onDelete"])):g("",!0)])],64)}}};export{Ue as default};
